<script setup>
  import { ref } from 'vue';

  const data = ref({
    name: 'CT4S HFO',
    state: 'error',
    params: [
      {
        name: 'Corr Ull',
        value: '8360',
        type: 'mm',
      },
      {
        name: 'Rel Press',
        value: '-7.7',
        type: 'mbar',
      },
      {
        name: 'UTemp L',
        value: '27.6',
        type: '°C',
      },
      {
        name: 'Vol Gr',
        value: '1.524',
        type: 'm3',
      },
      {
        name: 'Flow Rate',
        value: '0',
        type: 'm/h3',
      },
    ],
  });

  const testValue = ref(75);

  // Считает высоту шкалы (высоту прямоугольника)
  function scaleHeight() {
    let num = testValue.value;
    const oneUnit = 0.108;
    num *= oneUnit;
    num += 0.85;
    console.log(num);
    return num;
  }

  // Считает позицию кружка со значением
  function circlePosition() {
    let height = scaleHeight();
    const bottomIndent = 0.3;
    height -= bottomIndent;
    return height;
  }
  // Считает позицию значения, находящегося в кружке
  function valueInCirclePosition() {
    let height = scaleHeight();
    const bottomIndent = 0.7;
    height += bottomIndent;
    return height;
  }

  function warningSignPosition() {
    console.log('hu');
    let bottomIndent;
    if (testValue.value < 19) {
      bottomIndent = 11.25;
    } else {
      bottomIndent = 0.5;
    }
    return bottomIndent;
  }

  const stateColor = ref('#66FE87');
  function changeStateColor() {
    if (data.value.state != 'working') {
      stateColor.value = '#DB8181';
    }
    return stateColor.value;
  }
</script>

<template>
  <!-- Шкала -->
  <div
    class="h-[17vh] w-[13vw] rounded-[0.6vw] bg-gradient-to-b from-[rgba(214,235,255,0.4)] to-[rgba(39,42,52,0.4)] p-[0.1vw] font-euclid">
    <div class="flex h-full rounded-[0.6vw] bg-[#3E404C]">
      <div class="relative ml-[0.83vw] mt-[1.48vh] h-[14.07vh] w-[2.92vw]">
        <svg
          width="2.92vw"
          height="14.07vh"
          viewBox="0 0 58 154"
          fill="none"
          xmlns="http://www.w3.org/2000/svg">
          <path
            :stroke="changeStateColor()"
            d="M54.7584 15.5886V26.7719H57V37.9552H54.7584V49.1385H57V60.3218H54.7584V71.5051H57V82.6884H54.7584V93.8717H57V105.055H54.7584V116.238H57V127.422H54.7584V138.605H57V143.713C57 148.859 52.8647 153 47.7246 153H10.2754C5.13526 153 1 148.821 1 143.713V138.489H3.24156V127.306H1V116.122H3.24156V104.939H1V93.7943H3.24156V82.611H1V71.4277H3.24156V60.2444H1V49.0611H3.24156V37.8778H1V26.6945H3.24156V15.5112H1V10.2872C1 5.14053 5.17391 1 10.2754 1H47.7246C52.8647 1 57 5.14053 57 10.2872V15.5112H54.7584V15.5886Z"
            stroke="#66FE87"
            stroke-width="2"
            stroke-miterlimit="10"
            stroke-linecap="round"
            stroke-linejoin="round" />
          <rect
            :stroke="changeStateColor()"
            x="8"
            y="8"
            width="42"
            height="138"
            rx="5"
            stroke="#66FE87"
            stroke-width="2" />
          <path
            :fill="changeStateColor()"
            d="M32.48 20V13.99H31.05L31.89 12.9H33.58V20H32.48ZM39.437 19.34C38.957 19.8467 38.3404 20.1 37.587 20.1C36.8337 20.1 36.217 19.8467 35.737 19.34C35.257 18.8267 35.017 18.17 35.017 17.37V15.51C35.017 14.71 35.257 14.0567 35.737 13.55C36.217 13.0367 36.8337 12.78 37.587 12.78C38.3404 12.78 38.957 13.0367 39.437 13.55C39.9237 14.0567 40.167 14.71 40.167 15.51V17.37C40.167 18.17 39.9237 18.8267 39.437 19.34ZM37.587 19.02C38.0337 19.02 38.3904 18.8733 38.657 18.58C38.9304 18.2867 39.067 17.8833 39.067 17.37V15.51C39.067 14.9967 38.9304 14.5933 38.657 14.3C38.3904 14.0067 38.0337 13.86 37.587 13.86C37.147 13.86 36.7904 14.0067 36.517 14.3C36.2504 14.5933 36.117 14.9967 36.117 15.51V17.37C36.117 17.8833 36.2504 18.2867 36.517 18.58C36.7904 18.8733 37.147 19.02 37.587 19.02ZM45.6968 19.34C45.2168 19.8467 44.6001 20.1 43.8468 20.1C43.0935 20.1 42.4768 19.8467 41.9968 19.34C41.5168 18.8267 41.2768 18.17 41.2768 17.37V15.51C41.2768 14.71 41.5168 14.0567 41.9968 13.55C42.4768 13.0367 43.0935 12.78 43.8468 12.78C44.6001 12.78 45.2168 13.0367 45.6968 13.55C46.1835 14.0567 46.4268 14.71 46.4268 15.51V17.37C46.4268 18.17 46.1835 18.8267 45.6968 19.34ZM43.8468 19.02C44.2935 19.02 44.6501 18.8733 44.9168 18.58C45.1901 18.2867 45.3268 17.8833 45.3268 17.37V15.51C45.3268 14.9967 45.1901 14.5933 44.9168 14.3C44.6501 14.0067 44.2935 13.86 43.8468 13.86C43.4068 13.86 43.0501 14.0067 42.7768 14.3C42.5101 14.5933 42.3768 14.9967 42.3768 15.51V17.37C42.3768 17.8833 42.5101 18.2867 42.7768 18.58C43.0501 18.8733 43.4068 19.02 43.8468 19.02Z"
            fill="#66FE87" />
          <path
            :fill="changeStateColor()"
            d="M33.79 80.1C33.1433 80.1 32.5767 79.8967 32.09 79.49C31.6033 79.0833 31.3533 78.59 31.34 78.01H32.47C32.5433 78.31 32.7 78.5533 32.94 78.74C33.1867 78.9267 33.47 79.02 33.79 79.02C34.1833 79.02 34.5033 78.8933 34.75 78.64C34.9967 78.38 35.12 78.0667 35.12 77.7C35.12 77.32 34.9967 77.0067 34.75 76.76C34.51 76.5067 34.2 76.38 33.82 76.38C33.2467 76.38 32.8333 76.6233 32.58 77.11L31.59 76.8L32.35 72.9H35.73V73.97H33.21L32.88 75.67C33.1733 75.4633 33.5433 75.36 33.99 75.36C34.6567 75.36 35.1967 75.59 35.61 76.05C36.0233 76.51 36.23 77.0967 36.23 77.81C36.23 78.4767 36 79.0267 35.54 79.46C35.0867 79.8867 34.5033 80.1 33.79 80.1ZM41.6148 79.34C41.1348 79.8467 40.5181 80.1 39.7648 80.1C39.0114 80.1 38.3948 79.8467 37.9148 79.34C37.4348 78.8267 37.1948 78.17 37.1948 77.37V75.51C37.1948 74.71 37.4348 74.0567 37.9148 73.55C38.3948 73.0367 39.0114 72.78 39.7648 72.78C40.5181 72.78 41.1348 73.0367 41.6148 73.55C42.1014 74.0567 42.3448 74.71 42.3448 75.51V77.37C42.3448 78.17 42.1014 78.8267 41.6148 79.34ZM39.7648 79.02C40.2114 79.02 40.5681 78.8733 40.8348 78.58C41.1081 78.2867 41.2448 77.8833 41.2448 77.37V75.51C41.2448 74.9967 41.1081 74.5933 40.8348 74.3C40.5681 74.0067 40.2114 73.86 39.7648 73.86C39.3248 73.86 38.9681 74.0067 38.6948 74.3C38.4281 74.5933 38.2948 74.9967 38.2948 75.51V77.37C38.2948 77.8833 38.4281 78.2867 38.6948 78.58C38.9681 78.8733 39.3248 79.02 39.7648 79.02Z"
            fill="#66FE87" />
          <path
            :fill="changeStateColor()"
            d="M32.78 50H31.54L34.8 43.97H31.31V42.9H36.11V43.84L32.78 50ZM38.9267 50.1C38.2801 50.1 37.7134 49.8967 37.2267 49.49C36.7401 49.0833 36.4901 48.59 36.4767 48.01H37.6067C37.6801 48.31 37.8367 48.5533 38.0767 48.74C38.3234 48.9267 38.6067 49.02 38.9267 49.02C39.3201 49.02 39.6401 48.8933 39.8867 48.64C40.1334 48.38 40.2567 48.0667 40.2567 47.7C40.2567 47.32 40.1334 47.0067 39.8867 46.76C39.6467 46.5067 39.3367 46.38 38.9567 46.38C38.3834 46.38 37.9701 46.6233 37.7167 47.11L36.7267 46.8L37.4867 42.9H40.8667V43.97H38.3467L38.0167 45.67C38.3101 45.4633 38.6801 45.36 39.1267 45.36C39.7934 45.36 40.3334 45.59 40.7467 46.05C41.1601 46.51 41.3667 47.0967 41.3667 47.81C41.3667 48.4767 41.1367 49.0267 40.6767 49.46C40.2234 49.8867 39.6401 50.1 38.9267 50.1Z"
            fill="#66FE87" />
          <path
            :fill="changeStateColor()"
            d="M36.16 108.92V110H31.46V109.6C31.46 109.347 31.4967 109.107 31.57 108.88C31.65 108.647 31.7333 108.453 31.82 108.3C31.9067 108.147 32.05 107.977 32.25 107.79C32.45 107.597 32.6033 107.46 32.71 107.38C32.8167 107.293 33.0033 107.153 33.27 106.96C33.5433 106.767 33.7167 106.643 33.79 106.59C34.21 106.283 34.5133 106.013 34.7 105.78C34.8867 105.547 34.98 105.267 34.98 104.94C34.98 104.613 34.88 104.353 34.68 104.16C34.48 103.96 34.2033 103.86 33.85 103.86C33.4833 103.86 33.18 103.97 32.94 104.19C32.7 104.403 32.5767 104.697 32.57 105.07H31.46C31.46 104.397 31.6867 103.847 32.14 103.42C32.6 102.993 33.1733 102.78 33.86 102.78C34.4933 102.78 35.0233 102.967 35.45 103.34C35.8767 103.713 36.09 104.237 36.09 104.91C36.09 105.443 35.9667 105.893 35.72 106.26C35.48 106.62 35.08 107 34.52 107.4C34.4333 107.467 34.2733 107.58 34.04 107.74C33.8067 107.9 33.6333 108.023 33.52 108.11C33.4133 108.197 33.2967 108.317 33.17 108.47C33.0433 108.617 32.9567 108.767 32.91 108.92H36.16ZM39.4443 110.1C38.7976 110.1 38.231 109.897 37.7443 109.49C37.2576 109.083 37.0076 108.59 36.9943 108.01H38.1243C38.1976 108.31 38.3543 108.553 38.5943 108.74C38.841 108.927 39.1243 109.02 39.4443 109.02C39.8376 109.02 40.1576 108.893 40.4043 108.64C40.651 108.38 40.7743 108.067 40.7743 107.7C40.7743 107.32 40.651 107.007 40.4043 106.76C40.1643 106.507 39.8543 106.38 39.4743 106.38C38.901 106.38 38.4876 106.623 38.2343 107.11L37.2443 106.8L38.0043 102.9H41.3843V103.97H38.8643L38.5343 105.67C38.8276 105.463 39.1976 105.36 39.6443 105.36C40.311 105.36 40.851 105.59 41.2643 106.05C41.6776 106.51 41.8843 107.097 41.8843 107.81C41.8843 108.477 41.6543 109.027 41.1943 109.46C40.741 109.887 40.1576 110.1 39.4443 110.1Z"
            fill="#66FE87" />
          <path
            :fill="changeStateColor()"
            d="M35.98 139.34C35.5 139.847 34.8833 140.1 34.13 140.1C33.3767 140.1 32.76 139.847 32.28 139.34C31.8 138.827 31.56 138.17 31.56 137.37V135.51C31.56 134.71 31.8 134.057 32.28 133.55C32.76 133.037 33.3767 132.78 34.13 132.78C34.8833 132.78 35.5 133.037 35.98 133.55C36.4667 134.057 36.71 134.71 36.71 135.51V137.37C36.71 138.17 36.4667 138.827 35.98 139.34ZM34.13 139.02C34.5767 139.02 34.9333 138.873 35.2 138.58C35.4733 138.287 35.61 137.883 35.61 137.37V135.51C35.61 134.997 35.4733 134.593 35.2 134.3C34.9333 134.007 34.5767 133.86 34.13 133.86C33.69 133.86 33.3333 134.007 33.06 134.3C32.7933 134.593 32.66 134.997 32.66 135.51V137.37C32.66 137.883 32.7933 138.287 33.06 138.58C33.3333 138.873 33.69 139.02 34.13 139.02Z"
            fill="#66FE87" />

          <path
            :stroke="changeStateColor()"
            d="M27 61.9907H30"
            stroke="#66FE87"
            stroke-miterlimit="10" />
          <path
            :stroke="changeStateColor()"
            d="M27 31.9873H30"
            stroke="#66FE87"
            stroke-miterlimit="10" />
          <path
            :stroke="changeStateColor()"
            d="M27 121.998H30"
            stroke="#66FE87"
            stroke-miterlimit="10" />
          <path
            :stroke="changeStateColor()"
            d="M27 91.9946H30"
            stroke="#66FE87"
            stroke-miterlimit="10" />
          <path
            :stroke="changeStateColor()"
            d="M27 77H28.4801H29.9602"
            stroke="#66FE87"
            stroke-miterlimit="10" />
          <path
            :stroke="changeStateColor()"
            d="M27 47H29.9602"
            stroke="#66FE87"
            stroke-miterlimit="10" />
          <path
            :stroke="changeStateColor()"
            d="M27 107H29.9602"
            stroke="#66FE87"
            stroke-miterlimit="10" />
          <path
            :stroke="changeStateColor()"
            d="M27 137H29.9602"
            stroke="#66FE87"
            stroke-miterlimit="10" />
          <path
            :stroke="changeStateColor()"
            d="M27 17H29.9602"
            stroke="#66FE87"
            stroke-miterlimit="10" />
          <path
            :stroke="changeStateColor()"
            d="M8 13C8 10.2386 10.2386 8 13 8H26V146H13C10.2386 146 8 143.761 8 141V13Z"
            stroke="#66FE87"
            stroke-width="2" />
        </svg>
        <!-- Прямоугольник меры -->
        <div
          :style="{ height: scaleHeight() + 'vh', 'background-color': changeStateColor() }"
          class="absolute left-[0.39vw] bottom-[0.8vh] w-[0.9vw] rounded-bl-md bg-[#66FE87]"></div>
        <!-- Кружок со значением -->
        <svg
          class="absolute left-[0.2vw] h-[2.22vh] w-[1.25vw]"
          :stroke="changeStateColor()"
          :style="{ bottom: circlePosition() + 'vh' }"
          width="1.25vw"
          height="2.22vh"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg">
          <rect
            :stroke="changeStateColor()"
            x="0.5"
            y="0.5"
            width="23"
            height="23"
            rx="11.5"
            fill="#3E404C"
            stroke="#66FE87" />
        </svg>

        <!-- Значение в кружке -->
        <div
          class="absolute left-[0.22vw] h-[0.92vh] w-[1.25vw] text-center text-[0.625vw]"
          :style="{ bottom: valueInCirclePosition() + 'vh', color: changeStateColor() }">
          {{ testValue }}
        </div>
        <!-- Значок с предупреждением -->
        <svg
          v-if="['error', 'warning'].includes(data.state)"
          class="absolute left-[0.2vw] h-[2.22vh] w-[1.25vw]"
          :style="{ bottom: warningSignPosition() + 'vh' }"
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="11.5" fill="#393C4D" stroke="#DB8181" />
          <path
            d="M12.006 9.33846V12.1141M12.006 13.7795H12.012M17.8394 14.3346L13.0432 6.56284C12.9386 6.39197 12.7869 6.24985 12.6037 6.15097C12.4204 6.0521 12.2121 6 12 6C11.7879 6 11.5796 6.0521 11.3963 6.15097C11.2131 6.24985 11.0614 6.39197 10.9568 6.56284L6.16067 14.3346C6.05496 14.5041 5.99953 14.6965 6 14.8922C6.00047 15.088 6.05682 15.2801 6.16334 15.4492C6.26985 15.6183 6.42275 15.7582 6.60653 15.855C6.79031 15.9517 6.99845 16.0017 7.20983 16H16.8022C17.0126 15.9998 17.2192 15.9483 17.4013 15.8508C17.5834 15.7533 17.7346 15.6131 17.8397 15.4443C17.9448 15.2756 18.0001 15.0842 18 14.8894C17.9999 14.6946 17.9445 14.5033 17.8394 14.3346Z"
            stroke="#DB8181"
            stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </div>

      <div class="mt-[0.83vw] flex flex-col">
        <div
          class="rounded-tr-0 rounded-br-0 ml-[0.73vw] flex h-[2.9vh] w-[8.3vw] items-center rounded-tl-3xl rounded-bl-3xl bg-[#272933]">
          <div class="ml-[0.83vw] truncate font-euclid text-[0.94vw] font-medium text-[#D6EBFF]">
            CT3P HFO
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
